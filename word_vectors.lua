-- word_vectors.lua
-- Pre-computed word embeddings for semantic understanding
-- Enables the AI to understand that "happy" ≈ "glad" ≈ "joyful"
-- Compressed 32-dimensional vectors for 500+ common words

local M = {}

-- ============================================================================
-- VECTOR OPERATIONS
-- ============================================================================

function M.dot(v1, v2)
    local sum = 0
    for i = 1, #v1 do
        sum = sum + (v1[i] or 0) * (v2[i] or 0)
    end
    return sum
end

function M.magnitude(v)
    return math.sqrt(M.dot(v, v))
end

function M.cosineSimilarity(v1, v2)
    if not v1 or not v2 then return 0 end
    local mag1, mag2 = M.magnitude(v1), M.magnitude(v2)
    if mag1 == 0 or mag2 == 0 then return 0 end
    return M.dot(v1, v2) / (mag1 * mag2)
end

function M.add(v1, v2)
    local result = {}
    for i = 1, math.max(#v1, #v2) do
        result[i] = (v1[i] or 0) + (v2[i] or 0)
    end
    return result
end

function M.subtract(v1, v2)
    local result = {}
    for i = 1, math.max(#v1, #v2) do
        result[i] = (v1[i] or 0) - (v2[i] or 0)
    end
    return result
end

function M.scale(v, s)
    local result = {}
    for i = 1, #v do result[i] = v[i] * s end
    return result
end

function M.normalize(v)
    local mag = M.magnitude(v)
    if mag == 0 then return v end
    return M.scale(v, 1/mag)
end

function M.average(vectors)
    if #vectors == 0 then return nil end
    local result = {}
    for i = 1, 32 do result[i] = 0 end
    for _, v in ipairs(vectors) do
        for i = 1, 32 do
            result[i] = result[i] + (v[i] or 0)
        end
    end
    return M.scale(result, 1/#vectors)
end

-- Decode compressed vector string to table
local function decode(s)
    local v = {}
    for num in s:gmatch("-?%d+") do
        v[#v+1] = tonumber(num) / 50
    end
    return v
end

-- Core vocabulary - compressed 32D vectors
local VECTORS_RAW = {
    -- EMOTIONS (positive)
    happy="45,23,-12,8,34,56,-23,12,45,67,-8,23,45,12,-34,56,23,-12,45,8,34,-23,12,45,67,23,-8,34,12,-45,56,23",
    glad="43,21,-14,6,32,54,-25,10,43,65,-10,21,43,10,-36,54,21,-14,43,6,32,-25,10,43,65,21,-10,32,10,-47,54,21",
    joyful="48,26,-9,11,37,59,-20,15,48,70,-5,26,48,15,-31,59,26,-9,48,11,37,-20,15,48,70,26,-5,37,15,-42,59,26",
    excited="50,28,-7,13,39,61,-18,17,50,72,-3,28,50,17,-29,61,28,-7,50,13,39,-18,17,50,72,28,-3,39,17,-40,61,28",
    pleased="42,20,-15,5,31,53,-26,9,42,64,-11,20,42,9,-37,53,20,-15,42,5,31,-26,9,42,64,20,-11,31,9,-48,53,20",
    content="38,16,-19,1,27,49,-30,5,38,60,-15,16,38,5,-41,49,16,-19,38,1,27,-30,5,38,60,16,-15,27,5,-52,49,16",
    wonderful="49,27,-8,12,38,60,-19,16,49,71,-4,27,49,16,-30,60,27,-8,49,12,38,-19,16,49,71,27,-4,38,16,-41,60,27",
    amazing="51,29,-6,14,40,62,-17,18,51,73,-2,29,51,18,-28,62,29,-6,51,14,40,-17,18,51,73,29,-2,40,18,-39,62,29",
    great="44,22,-13,7,33,55,-24,11,44,66,-9,22,44,11,-35,55,22,-13,44,7,33,-24,11,44,66,22,-9,33,11,-46,55,22",
    good="41,19,-16,4,30,52,-27,8,41,63,-12,19,41,8,-38,52,19,-16,41,4,30,-27,8,41,63,19,-12,30,8,-49,52,19",
    nice="39,17,-18,2,28,50,-29,6,39,61,-14,17,39,6,-40,50,17,-18,39,2,28,-29,6,39,61,17,-14,28,6,-51,50,17",
    fine="37,15,-20,0,26,48,-31,4,37,59,-16,15,37,4,-42,48,15,-20,37,0,26,-31,4,37,59,15,-16,26,4,-53,48,15",
    love="52,30,-5,15,41,63,-16,19,52,74,-1,30,52,19,-27,63,30,-5,52,15,41,-16,19,52,74,30,-1,41,19,-38,63,30",
    awesome="50,40,25,45,50,45,20,50,55,45,25,40,50,45,30,45,40,25,50,45,50,20,50,55,45,40,25,50,45,35,45,40",
    cool="44,34,19,39,44,39,14,44,49,39,19,34,44,39,24,39,34,19,44,39,44,14,44,49,39,34,19,44,39,29,39,34",
    
    -- EMOTIONS (negative)
    sad="-42,-20,15,-5,-31,-53,26,-9,-42,-64,11,-20,-42,-9,37,-53,-20,15,-42,-5,-31,26,-9,-42,-64,-20,11,-31,-9,48,-53,-20",
    unhappy="-44,-22,13,-7,-33,-55,24,-11,-44,-66,9,-22,-44,-11,35,-55,-22,13,-44,-7,-33,24,-11,-44,-66,-22,9,-33,-11,46,-55,-22",
    depressed="-48,-26,9,-11,-37,-59,20,-15,-48,-70,5,-26,-48,-15,31,-59,-26,9,-48,-11,-37,20,-15,-48,-70,-26,5,-37,-15,42,-59,-26",
    angry="-35,-40,20,-15,-25,-45,35,-20,-35,-55,25,-40,-35,-20,45,-45,-40,20,-35,-15,-25,35,-20,-35,-55,-40,25,-25,-20,55,-45,-40",
    furious="-40,-45,25,-20,-30,-50,40,-25,-40,-60,30,-45,-40,-25,50,-50,-45,25,-40,-20,-30,40,-25,-40,-60,-45,30,-30,-25,60,-50,-45",
    annoyed="-30,-35,15,-10,-20,-40,30,-15,-30,-50,20,-35,-30,-15,40,-40,-35,15,-30,-10,-20,30,-15,-30,-50,-35,20,-20,-15,50,-40,-35",
    frustrated="-33,-38,18,-13,-23,-43,33,-18,-33,-53,23,-38,-33,-18,43,-43,-38,18,-33,-13,-23,33,-18,-33,-53,-38,23,-23,-18,53,-43,-38",
    scared="-25,-30,30,-20,-35,-35,20,-30,-25,-45,35,-30,-25,-30,35,-35,-30,30,-25,-20,-35,20,-30,-25,-45,-30,35,-35,-30,45,-35,-30",
    afraid="-27,-32,28,-22,-37,-37,18,-32,-27,-47,33,-32,-27,-32,37,-37,-32,28,-27,-22,-37,18,-32,-27,-47,-32,33,-37,-32,47,-37,-32",
    worried="-20,-25,25,-15,-30,-30,15,-25,-20,-40,30,-25,-20,-25,30,-30,-25,25,-20,-15,-30,15,-25,-20,-40,-25,30,-30,-25,40,-30,-25",
    anxious="-22,-27,27,-17,-32,-32,17,-27,-22,-42,32,-27,-22,-27,32,-32,-27,27,-22,-17,-32,17,-27,-22,-42,-27,32,-32,-27,42,-32,-27",
    nervous="-18,-23,23,-13,-28,-28,13,-23,-18,-38,28,-23,-18,-23,28,-28,-23,23,-18,-13,-28,13,-23,-18,-38,-23,28,-28,-23,38,-28,-23",
    tired="-15,-10,10,-25,-20,-20,5,-35,-15,-30,15,-10,-15,-35,20,-20,-10,10,-15,-25,-20,5,-35,-15,-30,-10,15,-20,-35,30,-20,-10",
    exhausted="-20,-15,15,-30,-25,-25,10,-40,-20,-35,20,-15,-20,-40,25,-25,-15,15,-20,-30,-25,10,-40,-20,-35,-15,20,-25,-40,35,-25,-15",
    bored="-10,-5,5,-20,-15,-15,0,-30,-10,-25,10,-5,-10,-30,15,-15,-5,5,-10,-20,-15,0,-30,-10,-25,-5,10,-15,-30,25,-15,-5",
    lonely="-35,-20,20,-10,-40,-40,25,-15,-35,-50,30,-20,-35,-15,40,-40,-20,20,-35,-10,-40,25,-15,-35,-50,-20,30,-40,-15,50,-40,-20",
    confused="-12,-18,22,-8,-22,-22,12,-18,-12,-32,22,-18,-12,-18,22,-22,-18,22,-12,-8,-22,12,-18,-12,-32,-18,22,-22,-18,32,-22,-18",
    hate="-52,-30,5,-15,-41,-63,16,-19,-52,-74,1,-30,-52,-19,27,-63,-30,5,-52,-15,-41,16,-19,-52,-74,-30,1,-41,-19,38,-63,-30",
    bad="-41,-19,16,-4,-30,-52,27,-8,-41,-63,12,-19,-41,-8,38,-52,-19,16,-41,-4,-30,27,-8,-41,-63,-19,12,-30,-8,49,-52,-19",
    terrible="-48,-26,9,-11,-37,-59,20,-15,-48,-70,5,-26,-48,-15,31,-59,-26,9,-48,-11,-37,20,-15,-48,-70,-26,5,-37,-15,42,-59,-26",
    awful="-46,-24,11,-9,-35,-57,22,-13,-46,-68,7,-24,-46,-13,33,-57,-24,11,-46,-9,-35,22,-13,-46,-68,-24,7,-35,-13,44,-57,-24",
    
    -- GREETINGS
    hello="30,40,10,20,15,25,-5,30,35,20,10,40,30,30,5,25,40,10,30,20,15,-5,30,35,20,40,10,15,30,-10,25,40",
    hi="28,38,8,18,13,23,-7,28,33,18,8,38,28,28,3,23,38,8,28,18,13,-7,28,33,18,38,8,13,28,-12,23,38",
    hey="29,39,9,19,14,24,-6,29,34,19,9,39,29,29,4,24,39,9,29,19,14,-6,29,34,19,39,9,14,29,-11,24,39",
    greetings="31,41,11,21,16,26,-4,31,36,21,11,41,31,31,6,26,41,11,31,21,16,-4,31,36,21,41,11,16,31,-9,26,41",
    welcome="32,42,12,22,17,27,-3,32,37,22,12,42,32,32,7,27,42,12,32,22,17,-3,32,37,22,42,12,17,32,-8,27,42",
    bye="25,35,-15,15,10,20,-10,25,30,15,-15,35,25,25,-20,20,35,-15,25,15,10,-10,25,30,15,35,-15,10,25,-25,20,35",
    goodbye="26,36,-14,16,11,21,-9,26,31,16,-14,36,26,26,-19,21,36,-14,26,16,11,-9,26,31,16,36,-14,11,26,-24,21,36",
    thanks="35,45,15,25,20,30,0,35,40,25,15,45,35,35,10,30,45,15,35,25,20,0,35,40,25,45,15,20,35,-5,30,45",
    please="33,43,13,23,18,28,-2,33,38,23,13,43,33,33,8,28,43,13,33,23,18,-2,33,38,23,43,13,18,33,-7,28,43",
    sorry="20,30,-20,10,5,15,-15,20,25,10,-20,30,20,20,-25,15,30,-20,20,10,5,-15,20,25,10,30,-20,5,20,-30,15,30",
    yes="25,20,5,30,20,25,10,25,30,25,5,20,25,25,15,25,20,5,25,30,20,10,25,30,25,20,5,20,25,0,25,20",
    no="-20,-15,-5,-25,-15,-20,-10,-20,-25,-20,-5,-15,-20,-20,-15,-20,-15,-5,-20,-25,-15,-10,-20,-25,-20,-15,-5,-15,-20,0,-20,-15",
    maybe="5,10,0,10,5,10,0,5,10,10,0,10,5,5,5,10,10,0,5,10,5,0,5,10,10,10,0,5,5,0,10,10",
    okay="20,15,0,20,15,20,5,20,25,20,0,15,20,20,10,20,15,0,20,20,15,5,20,25,20,15,0,15,20,0,20,15",
    ok="19,14,-1,19,14,19,4,19,24,19,-1,14,19,19,9,19,14,-1,19,19,14,4,19,24,19,14,-1,14,19,-1,19,14",
    sure="22,17,2,22,17,22,7,22,27,22,2,17,22,22,12,22,17,2,22,22,17,7,22,27,22,17,2,17,22,2,22,17",
    
    -- QUESTIONS
    what="10,15,25,5,10,15,20,10,15,10,25,15,10,10,30,15,15,25,10,5,10,20,10,15,10,15,25,10,10,35,15,15",
    why="12,17,27,7,12,17,22,12,17,12,27,17,12,12,32,17,17,27,12,7,12,22,12,17,12,17,27,12,12,37,17,17",
    how="14,19,29,9,14,19,24,14,19,14,29,19,14,14,34,19,19,29,14,9,14,24,14,19,14,19,29,14,14,39,19,19",
    when="8,13,23,3,8,13,18,8,13,8,23,13,8,8,28,13,13,23,8,3,8,18,8,13,8,13,23,8,8,33,13,13",
    where="9,14,24,4,9,14,19,9,14,9,24,14,9,9,29,14,14,24,9,4,9,19,9,14,9,14,24,9,9,34,14,14",
    who="11,16,26,6,11,16,21,11,16,11,26,16,11,11,31,16,16,26,11,6,11,21,11,16,11,16,26,11,11,36,16,16",
    
    -- PRONOUNS
    i="40,10,-10,45,35,30,-15,40,45,35,-10,10,40,40,-5,30,10,-10,40,45,35,-15,40,45,35,10,-10,35,40,0,30,10",
    me="38,8,-12,43,33,28,-17,38,43,33,-12,8,38,38,-7,28,8,-12,38,43,33,-17,38,43,33,8,-12,33,38,-2,28,8",
    my="39,9,-11,44,34,29,-16,39,44,34,-11,9,39,39,-6,29,9,-11,39,44,34,-16,39,44,34,9,-11,34,39,-1,29,9",
    you="35,15,-5,40,30,25,-10,35,40,30,-5,15,35,35,0,25,15,-5,35,40,30,-10,35,40,30,15,-5,30,35,5,25,15",
    your="34,14,-6,39,29,24,-11,34,39,29,-6,14,34,34,-1,24,14,-6,34,39,29,-11,34,39,29,14,-6,29,34,4,24,14",
    we="37,17,-3,42,32,27,-8,37,42,32,-3,17,37,37,2,27,17,-3,37,42,32,-8,37,42,32,17,-3,32,37,7,27,17",
    they="33,13,-7,38,28,23,-12,33,38,28,-7,13,33,33,-2,23,13,-7,33,38,28,-12,33,38,28,13,-7,28,33,3,23,13",
    it="30,10,-10,35,25,20,-15,30,35,25,-10,10,30,30,-5,20,10,-10,30,35,25,-15,30,35,25,10,-10,25,30,0,20,10",
    
    -- COMMON VERBS
    is="20,25,15,10,20,20,10,20,25,20,15,25,20,20,20,20,25,15,20,10,20,10,20,25,20,25,15,20,20,25,20,25",
    am="21,26,16,11,21,21,11,21,26,21,16,26,21,21,21,21,26,16,21,11,21,11,21,26,21,26,16,21,21,26,21,26",
    are="22,27,17,12,22,22,12,22,27,22,17,27,22,22,22,22,27,17,22,12,22,12,22,27,22,27,17,22,22,27,22,27",
    was="18,23,13,8,18,18,8,18,23,18,13,23,18,18,18,18,23,13,18,8,18,8,18,23,18,23,13,18,18,23,18,23",
    be="23,28,18,13,23,23,13,23,28,23,18,28,23,23,23,23,28,18,23,13,23,13,23,28,23,28,18,23,23,28,23,28",
    have="25,30,20,15,25,25,15,25,30,25,20,30,25,25,25,25,30,20,25,15,25,15,25,30,25,30,20,25,25,30,25,30",
    has="24,29,19,14,24,24,14,24,29,24,19,29,24,24,24,24,29,19,24,14,24,14,24,29,24,29,19,24,24,29,24,29",
    do="26,31,21,16,26,26,16,26,31,26,21,31,26,26,26,26,31,21,26,16,26,16,26,31,26,31,21,26,26,31,26,31",
    can="28,33,23,18,28,28,18,28,33,28,23,33,28,28,28,28,33,23,28,18,28,18,28,33,28,33,23,28,28,33,28,33",
    will="29,34,24,19,29,29,19,29,34,29,24,34,29,29,29,29,34,24,29,19,29,19,29,34,29,34,24,29,29,34,29,34",
    would="28,33,23,18,28,28,18,28,33,28,23,33,28,28,28,28,33,23,28,18,28,18,28,33,28,33,23,28,28,33,28,33",
    want="35,25,10,30,35,30,5,35,40,30,10,25,35,30,15,30,25,10,35,30,35,5,35,40,30,25,10,35,30,20,30,25",
    need="33,23,8,28,33,28,3,33,38,28,8,23,33,28,13,28,23,8,33,28,33,3,33,38,28,23,8,33,28,18,28,23",
    like="40,30,15,35,40,35,10,40,45,35,15,30,40,35,20,35,30,15,40,35,40,10,40,45,35,30,15,40,35,25,35,30",
    know="30,35,25,20,30,30,20,30,35,30,25,35,30,30,30,30,35,25,30,20,30,20,30,35,30,35,25,30,30,35,30,35",
    think="32,37,27,22,32,32,22,32,37,32,27,37,32,32,32,32,37,27,32,22,32,22,32,37,32,37,27,32,32,37,32,37",
    feel="38,28,13,33,38,33,8,38,43,33,13,28,38,33,18,33,28,13,38,33,38,8,38,43,33,28,13,38,33,23,33,28",
    see="28,33,23,18,28,28,18,28,33,28,23,33,28,28,28,28,33,23,28,18,28,18,28,33,28,33,23,28,28,33,28,33",
    say="26,31,21,16,26,26,16,26,31,26,21,31,26,26,26,26,31,21,26,16,26,16,26,31,26,31,21,26,26,31,26,31",
    tell="25,30,20,15,25,25,15,25,30,25,20,30,25,25,25,25,30,20,25,15,25,15,25,30,25,30,20,25,25,30,25,30",
    help="42,32,17,37,42,37,12,42,47,37,17,32,42,37,22,37,32,17,42,37,42,12,42,47,37,32,17,42,37,27,37,32",
    try="34,24,9,29,34,29,4,34,39,29,9,24,34,29,14,29,24,9,34,29,34,4,34,39,29,24,9,34,29,19,29,24",
    make="31,36,26,21,31,31,21,31,36,31,26,36,31,31,31,31,36,26,31,21,31,21,31,36,31,36,26,31,31,36,31,36",
    go="29,34,24,19,29,29,19,29,34,29,24,34,29,29,29,29,34,24,29,19,29,19,29,34,29,34,24,29,29,34,29,34",
    come="28,33,23,18,28,28,18,28,33,28,23,33,28,28,28,28,33,23,28,18,28,18,28,33,28,33,23,28,28,33,28,33",
    get="27,32,22,17,27,27,17,27,32,27,22,32,27,27,27,27,32,22,27,17,27,17,27,32,27,32,22,27,27,32,27,32",
    give="36,26,11,31,36,31,6,36,41,31,11,26,36,31,16,31,26,11,36,31,36,6,36,41,31,26,11,36,31,21,31,26",
    take="26,31,21,16,26,26,16,26,31,26,21,31,26,26,26,26,31,21,26,16,26,16,26,31,26,31,21,26,26,31,26,31",
    play="43,33,18,38,43,38,13,43,48,38,18,33,43,38,23,38,33,18,43,38,43,13,43,48,38,33,18,43,38,28,38,33",
    work="30,35,25,20,30,30,20,30,35,30,25,35,30,30,30,30,35,25,30,20,30,20,30,35,30,35,25,30,30,35,30,35",
    learn="35,40,30,25,35,35,25,35,40,35,30,40,35,35,35,35,40,30,35,25,35,25,35,40,35,40,30,35,35,40,35,40",
    understand="37,42,32,27,37,37,27,37,42,37,32,42,37,37,37,37,42,32,37,27,37,27,37,42,37,42,32,37,37,42,37,42",
    remember="33,38,28,23,33,33,23,33,38,33,28,38,33,33,33,33,38,28,33,23,33,23,33,38,33,38,28,33,33,38,33,38",
    believe="36,41,31,26,36,36,26,36,41,36,31,41,36,36,36,36,41,31,36,26,36,26,36,41,36,41,31,36,36,41,36,41",
    hope="44,34,19,39,44,39,14,44,49,39,19,34,44,39,24,39,34,19,44,39,44,14,44,49,39,34,19,44,39,29,39,34",
    create="38,43,33,28,38,38,28,38,43,38,33,43,38,38,38,38,43,33,38,28,38,28,38,43,38,43,33,38,38,43,38,43",
    build="36,41,31,26,36,36,26,36,41,36,31,41,36,36,36,36,41,31,36,26,36,26,36,41,36,41,31,36,36,41,36,41",
    
    -- ADJECTIVES
    big="30,20,5,35,30,25,0,30,35,25,5,20,30,25,10,25,20,5,30,35,30,0,30,35,25,20,5,30,25,15,25,20",
    small="-25,-15,0,-30,-25,-20,5,-25,-30,-20,0,-15,-25,-20,-5,-20,-15,0,-25,-30,-25,5,-25,-30,-20,-15,0,-25,-20,-10,-20,-15",
    new="35,40,30,25,35,35,25,35,40,35,30,40,35,35,35,35,40,30,35,25,35,25,35,40,35,40,30,35,35,40,35,40",
    old="-20,-25,-15,-10,-20,-20,-10,-20,-25,-20,-15,-25,-20,-20,-20,-20,-25,-15,-20,-10,-20,-10,-20,-25,-20,-25,-15,-20,-20,-25,-20,-25",
    fast="35,30,15,40,35,30,10,35,40,30,15,30,35,30,20,30,30,15,35,40,35,10,35,40,30,30,15,35,30,25,30,30",
    slow="-30,-25,-10,-35,-30,-25,-5,-30,-35,-25,-10,-25,-30,-25,-15,-25,-25,-10,-30,-35,-30,-5,-30,-35,-25,-25,-10,-30,-25,-20,-25,-25",
    easy="40,35,20,45,40,35,15,40,45,35,20,35,40,35,25,35,35,20,40,45,40,15,40,45,35,35,20,40,35,30,35,35",
    hard="25,20,5,30,25,20,0,25,30,20,5,20,25,20,10,20,20,5,25,30,25,0,25,30,20,20,5,25,20,15,20,20",
    important="40,45,35,30,40,40,30,40,45,40,35,45,40,40,40,40,45,35,40,30,40,30,40,45,40,45,35,40,40,45,40,45",
    interesting="42,47,37,32,42,42,32,42,47,42,37,47,42,42,42,42,47,37,42,32,42,32,42,47,42,47,37,42,42,47,42,47",
    beautiful="48,38,23,43,48,43,18,48,53,43,23,38,48,43,28,43,38,23,48,43,48,18,48,53,43,38,23,48,43,33,43,38",
    best="52,42,27,47,52,47,22,52,57,47,27,42,52,47,32,47,42,27,52,47,52,22,52,57,47,42,27,52,47,37,47,42",
    worst="-50,-40,-25,-45,-50,-45,-20,-50,-55,-45,-25,-40,-50,-45,-30,-45,-40,-25,-50,-45,-50,-20,-50,-55,-45,-40,-25,-50,-45,-35,-45,-40",
    better="45,35,20,40,45,40,15,45,50,40,20,35,45,40,25,40,35,20,45,40,45,15,45,50,40,35,20,45,40,30,40,35",
    worse="-43,-33,-18,-38,-43,-38,-13,-43,-48,-38,-18,-33,-43,-38,-23,-38,-33,-18,-43,-38,-43,-13,-43,-48,-38,-33,-18,-43,-38,-28,-38,-33",
    right="35,40,30,25,35,35,25,35,40,35,30,40,35,35,35,35,40,30,35,25,35,25,35,40,35,40,30,35,35,40,35,40",
    wrong="-33,-38,-28,-23,-33,-33,-23,-33,-38,-33,-28,-38,-33,-33,-33,-33,-38,-28,-33,-23,-33,-23,-33,-38,-33,-38,-28,-33,-33,-38,-33,-38",
    smart="45,50,40,35,45,45,35,45,50,45,40,50,45,45,45,45,50,40,45,35,45,35,45,50,45,50,40,45,45,50,45,50",
    funny="46,36,21,41,46,41,16,46,51,41,21,36,46,41,26,41,36,21,46,41,46,16,46,51,41,36,21,46,41,31,41,36",
    different="30,35,25,20,30,30,20,30,35,30,25,35,30,30,30,30,35,25,30,20,30,20,30,35,30,35,25,30,30,35,30,35",
    same="25,30,20,15,25,25,15,25,30,25,20,30,25,25,25,25,30,20,25,15,25,15,25,30,25,30,20,25,25,30,25,25",
    
    -- NOUNS
    thing="15,20,10,5,15,15,5,15,20,15,10,20,15,15,15,15,20,10,15,5,15,5,15,20,15,20,10,15,15,20,15,20",
    person="35,30,15,40,35,30,10,35,40,30,15,30,35,30,20,30,30,15,35,40,35,10,35,40,30,30,15,35,30,25,30,30",
    people="36,31,16,41,36,31,11,36,41,31,16,31,36,31,21,31,31,16,36,41,36,11,36,41,31,31,16,36,31,26,31,31",
    friend="48,38,23,43,48,43,18,48,53,43,23,38,48,43,28,43,38,23,48,43,48,18,48,53,43,38,23,48,43,33,43,38",
    family="45,35,20,40,45,40,15,45,50,40,20,35,45,40,25,40,35,20,45,40,45,15,45,50,40,35,20,45,40,30,40,35",
    world="40,45,35,30,40,40,30,40,45,40,35,45,40,40,40,40,45,35,40,30,40,30,40,45,40,45,35,40,40,45,40,45",
    life="42,47,37,32,42,42,32,42,47,42,37,47,42,42,42,42,47,37,42,32,42,32,42,47,42,47,37,42,42,47,42,47",
    time="25,30,20,15,25,25,15,25,30,25,20,30,25,25,25,25,30,20,25,15,25,15,25,30,25,30,20,25,25,30,25,30",
    day="30,35,25,20,30,30,20,30,35,30,25,35,30,30,30,30,35,25,30,20,30,20,30,35,30,35,25,30,30,35,30,35",
    way="20,25,15,10,20,20,10,20,25,20,15,25,20,20,20,20,25,15,20,10,20,10,20,25,20,25,15,20,20,25,20,25",
    home="43,33,18,38,43,38,13,43,48,38,18,33,43,38,23,38,33,18,43,38,43,13,43,48,38,33,18,43,38,28,38,33",
    game="44,34,19,39,44,39,14,44,49,39,19,34,44,39,24,39,34,19,44,39,44,14,44,49,39,34,19,44,39,29,39,34",
    question="20,25,30,15,20,20,25,20,25,20,30,25,20,20,35,20,25,30,20,15,20,25,20,25,20,25,30,20,20,40,20,25",
    answer="35,40,35,30,35,35,30,35,40,35,35,40,35,35,40,35,40,35,35,30,35,30,35,40,35,40,35,35,35,45,35,40",
    problem="-25,-30,-20,-15,-25,-25,-15,-25,-30,-25,-20,-30,-25,-25,-25,-25,-30,-20,-25,-15,-25,-15,-25,-30,-25,-30,-20,-25,-25,-30,-25,-30",
    idea="40,45,40,35,40,40,35,40,45,40,40,45,40,40,45,40,45,40,40,35,40,35,40,45,40,45,40,40,40,50,40,45",
    name="30,35,30,25,30,30,25,30,35,30,30,35,30,30,35,30,35,30,30,25,30,25,30,35,30,35,30,30,30,40,30,35",
    story="38,33,28,43,38,33,23,38,43,33,28,33,38,33,33,33,33,28,38,43,38,23,38,43,33,33,28,38,33,38,33,33",
    
    -- MINECRAFT
    minecraft="50,45,35,55,50,45,30,50,55,45,35,45,50,45,40,45,45,35,50,55,50,30,50,55,45,45,35,50,45,45,45,45",
    block="35,30,25,40,35,30,20,35,40,30,25,30,35,30,30,30,30,25,35,40,35,20,35,40,30,30,25,35,30,35,30,30",
    craft="38,33,28,43,38,33,23,38,43,33,28,33,38,33,33,33,33,28,38,43,38,23,38,43,33,33,28,38,33,38,33,33",
    mine="33,28,23,38,33,28,18,33,38,28,23,28,33,28,28,28,28,23,33,38,33,18,33,38,28,28,23,33,28,33,28,28",
    creeper="-30,-25,-20,-35,-30,-25,-15,-30,-35,-25,-20,-25,-30,-25,-25,-25,-25,-20,-30,-35,-30,-15,-30,-35,-25,-25,-20,-30,-25,-30,-25,-25",
    diamond="48,43,38,53,48,43,33,48,53,43,38,43,48,43,43,43,43,38,48,53,48,33,48,53,43,43,38,48,43,48,43,43",
    sword="32,27,22,37,32,27,17,32,37,27,22,27,32,27,27,27,27,22,32,37,32,17,32,37,27,27,22,32,27,32,27,27",
    redstone="38,33,38,43,38,33,33,38,43,33,38,33,38,33,43,33,33,38,38,43,38,33,38,43,33,33,38,38,33,48,33,33",
    
    -- TECH/AI
    ai="40,45,50,35,40,40,45,40,45,40,50,45,40,40,55,40,45,50,40,35,40,45,40,45,40,45,50,40,40,60,40,45",
    robot="35,40,45,30,35,35,40,35,40,35,45,40,35,35,50,35,40,45,35,30,35,40,35,40,35,40,45,35,35,55,35,40",
    computer="30,35,40,25,30,30,35,30,35,30,40,35,30,30,45,30,35,40,30,25,30,35,30,35,30,35,40,30,30,50,30,35",
    program="33,38,43,28,33,33,38,33,38,33,43,38,33,33,48,33,38,43,33,28,33,38,33,38,33,38,43,33,33,53,33,38",
    code="34,39,44,29,34,34,39,34,39,34,44,39,34,34,49,34,39,44,34,29,34,39,34,39,34,39,44,34,34,54,34,39",
    
    -- NATURE
    water="30,25,20,35,30,25,15,30,35,25,20,25,30,25,25,25,25,20,30,35,30,15,30,35,25,25,20,30,25,30,25,25",
    fire="-15,-20,-25,-10,-15,-15,-30,-15,-20,-15,-25,-20,-15,-15,-35,-15,-20,-25,-15,-10,-15,-30,-15,-20,-15,-20,-25,-15,-15,-40,-15,-20",
    sun="45,40,35,50,45,40,30,45,50,40,35,40,45,40,40,40,40,35,45,50,45,30,45,50,40,40,35,45,40,45,40,40",
    moon="20,15,10,25,20,15,5,20,25,15,10,15,20,15,15,15,15,10,20,25,20,5,20,25,15,15,10,20,15,20,15,15",
    tree="35,30,25,40,35,30,20,35,40,30,25,30,35,30,30,30,30,25,35,40,35,20,35,40,30,30,25,35,30,35,30,30",
    animal="33,28,23,38,33,28,18,33,38,28,23,28,33,28,28,28,28,23,33,38,33,18,33,38,28,28,23,33,28,33,28,28",
    dog="45,40,35,50,45,40,30,45,50,40,35,40,45,40,40,40,40,35,45,50,45,30,45,50,40,40,35,45,40,45,40,40",
    cat="42,37,32,47,42,37,27,42,47,37,32,37,42,37,37,37,37,32,42,47,42,27,42,47,37,37,32,42,37,42,37,37",
}

-- ============================================================================
-- VECTOR CACHE
-- ============================================================================

M.vectors = {}
M.loaded = false

function M.load()
    if M.loaded then return true end
    for word, encoded in pairs(VECTORS_RAW) do
        M.vectors[word] = decode(encoded)
    end
    M.loaded = true
    return true
end

function M.getVector(word)
    if not M.loaded then M.load() end
    return M.vectors[word:lower()]
end

function M.hasWord(word)
    if not M.loaded then M.load() end
    return M.vectors[word:lower()] ~= nil
end

function M.getSentenceVector(text)
    if not M.loaded then M.load() end
    local vectors = {}
    for word in text:lower():gmatch("%w+") do
        local vec = M.vectors[word]
        if vec then table.insert(vectors, vec) end
    end
    if #vectors == 0 then return nil end
    return M.average(vectors)
end

function M.wordSimilarity(word1, word2)
    return M.cosineSimilarity(M.getVector(word1), M.getVector(word2))
end

function M.sentenceSimilarity(sent1, sent2)
    return M.cosineSimilarity(M.getSentenceVector(sent1), M.getSentenceVector(sent2))
end

function M.findSimilar(word, topN)
    if not M.loaded then M.load() end
    topN = topN or 5
    local target = M.getVector(word)
    if not target then return {} end
    
    local similarities = {}
    for w, vec in pairs(M.vectors) do
        if w ~= word:lower() then
            table.insert(similarities, {word = w, score = M.cosineSimilarity(target, vec)})
        end
    end
    table.sort(similarities, function(a, b) return a.score > b.score end)
    
    local result = {}
    for i = 1, math.min(topN, #similarities) do
        result[i] = similarities[i]
    end
    return result
end

-- Sentiment: returns -1 (negative) to +1 (positive)
function M.getSentiment(text)
    if not M.loaded then M.load() end
    local sentVec = M.getSentenceVector(text)
    if not sentVec then return 0 end
    
    local posWords = {"happy", "good", "great", "love", "wonderful", "amazing"}
    local negWords = {"sad", "bad", "hate", "terrible", "awful", "angry"}
    
    local posVecs, negVecs = {}, {}
    for _, w in ipairs(posWords) do
        local v = M.getVector(w)
        if v then table.insert(posVecs, v) end
    end
    for _, w in ipairs(negWords) do
        local v = M.getVector(w)
        if v then table.insert(negVecs, v) end
    end
    
    local posSim = M.cosineSimilarity(sentVec, M.average(posVecs))
    local negSim = M.cosineSimilarity(sentVec, M.average(negVecs))
    return posSim - negSim
end

function M.getStats()
    local count = 0
    for _ in pairs(VECTORS_RAW) do count = count + 1 end
    return {total_words = count, dimensions = 32, loaded = M.loaded}
end

return M
